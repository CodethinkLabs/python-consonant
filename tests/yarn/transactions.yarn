Applying and validations transactions
=====================================

Apply a transaction that modifies no objects
--------------------------------------------

Apply a transaction that modifies no objects and verify that none of
the objects have changed:

    SCENARIO apply a transaction that modifies nothing
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Modify no objects"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 0 objects

Apply a valid transaction that creates a new object
---------------------------------------------------

Apply a valid transaction that creates a new object and verify that
afterwards this object exists and no other objects were modified.

    SCENARIO apply a transaction that creates a new object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action class to "lane"
    AND      setting the object properties
    AND      setting the object text property "title" to "New Lane"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new lane"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 1 object
    AND      the newly created object has exactly 1 properties set
    AND      the property "title" of the newly created object is set to "New Lane"

Apply an invalid transaction that creates a new object of a non-existent class
------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates a new object of a non-existent class
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action class to "bucket"
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new bucket"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that creates a new object with a non-existent property
-----------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates a new object with a non-existent property
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "nonexistentproperty" to "Hello"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new card"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that creates a new object that references a non-existent object
--------------------------------------------------------------------------------------------

TODO - the example schema only has bidirectional references. To create
an object that references another, we have to not just have an
implementation of create but also of update actions.

Apply a valid transaction to a non-existent commit
--------------------------------------------------

    SCENARIO apply a transaction to a non-existent commit
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 12345678
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Modify no objects"
    AND      submitting the transaction based on the non-existent commit
    THEN     this fails

Apply a valid transaction that updates an object
-------------------------------------------------

Apply a valid transaction that updates an object and verify that
afterwards this object has been changed and no other objects were
modified.

    SCENARIO apply a transaction that updates an object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object text property "title" to "New card title"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 1 object
    AND      the object "633715b8-70ea-4b06-94c6-43ee83a8df9e" has exactly 2 properties set
    AND      the property "title" of "633715b8-70ea-4b06-94c6-43ee83a8df9e" is set to "New card title"
    AND      the property "lane" of "633715b8-70ea-4b06-94c6-43ee83a8df9e" references "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527"

Apply a valid transaction that creates and updates the same object
------------------------------------------------------------------

Apply a valid transaction that updates an object and then modifies
it in a separate action. Verify that afterwards this object has been
created with the change applied and that no other objects were modified.

    SCENARIO apply a transaction that creates and updates the same object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action id to "create-new-card"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "This is a new card"
    AND      defining an update action
    AND      setting the action target object to action: create-new-card
    AND      setting the object properties
    AND      setting the object text property "title" to "The updated title of the new card"
    AND      setting the object reference property "lane" to uuid: 27519b8d-8ad8-4558-8ea2-f128404e6f58
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and update a new card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 1 object
    AND      the newly created object has exactly 2 properties set
    AND      the property "title" of the newly created object is set to "The updated title of the new card"
    AND      the property "lane" of the newly created object references "27519b8d-8ad8-4558-8ea2-f128404e6f58"

Apply a valid transaction that updates the same object twice
------------------------------------------------------------

Apply a valid transaction that updates the same object twice, once
by refering to the object UUID and once by refering to the previous
update action. Verify that afterwards this object has been changed
as expected and that no other objects were modified.

    SCENARIO apply a transaction that updates the same object twice
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action id to "first update"
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object text property "title" to "Title 1"
    AND      defining an update action
    AND      setting the action target object to action: first update
    AND      setting the object properties
    AND      setting the object text property "title" to "Title 2"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card twice"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 1 object
    AND      the object "633715b8-70ea-4b06-94c6-43ee83a8df9e" has exactly 2 properties set
    AND      the property "title" of "633715b8-70ea-4b06-94c6-43ee83a8df9e" is set to "Title 2"
    AND      the property "lane" of "633715b8-70ea-4b06-94c6-43ee83a8df9e" references "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527"

Apply an invalid transaction that creates an object but doesn't set all mandatory properties
--------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates an object but doesn't set all mandatory properties
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action id to "create-new-card"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "This is a new card"
    AND      defining an update action
    AND      setting the action target object to action: create-new-card
    AND      setting the object properties
    AND      setting the object text property "title" to "The updated title of the new card"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and update a new card"
    AND      submitting the invalid transaction

    THEN     this fails

Apply an invalid transaction that updates a non-existent property
-----------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent property
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object text property "nonexistent" to "Yeah, hmm"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent property"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a non-existent object
---------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: i-do-not-exist
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a non-existent action
---------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent action
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to action: non-existent
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates an object only created later
----------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates an object only created later
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to action: create-the-card
    AND      setting the object properties
    AND      setting the object text property "title" to "Overwritten title"
    AND      defining a create action
    AND      setting the action id to "create-the-card"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "Original title"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and modify a card in an invalid way"
    AND      submitting the invalid transaction
    THEN     this fails

Apply a transaction that deletes an object and removes references to it
-----------------------------------------------------------------------

    SCENARIO apply a transaction that deletes an object and removes references to it
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      defining an update action
    AND      setting the action target object to uuid: 71bd32d7-f02c-4cdd-9f91-1e73ba9a9527
    AND      setting the object properties
    AND      setting the object list property "cards"
    AND      adding a list element uuid: efb3c4e5-3ee0-4171-bddd-a56e9b0765cd
    AND      adding a list element uuid: 7501f1f4-e357-4af4-b5ff-546fae3f25f4
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 2 objects
    AND      the objects of class "card" do not include "633715b8-70ea-4b06-94c6-43ee83a8df9e"
    AND      the object "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527" has exactly 2 properties set
    AND      the property "cards" of "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527" contains exactly 2 elements
    AND      the property "cards" of "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527" includes the object "efb3c4e5-3ee0-4171-bddd-a56e9b0765cd"
    AND      the property "cards" of "71bd32d7-f02c-4cdd-9f91-1e73ba9a9527" includes the object "7501f1f4-e357-4af4-b5ff-546fae3f25f4"

Apply a transaction that creates an object and deletes it again
---------------------------------------------------------------

    SCENARIO apply a transaction that creates an object and deletes it again
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action id to "create"
    AND      setting the action class to "lane"
    AND      setting the object properties
    AND      setting the object text property "title" to "New lane"
    AND      defining a delete action
    AND      setting the action target object to action: create
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a card and delete it again"
    AND      submitting the transaction
    AND      fetching objects from the latest commit
    THEN     the transaction affects exactly 0 objects

Apply an invalid transaction that deletes an object but does not remove references to it
----------------------------------------------------------------------------------------

TODO: the scenario below can only be added once there is a functional
implementation of validating commits resulting from transactions in
python-consonant.

SCENARIO apply an invalid transaction that deletes an object but does not removes references to it
GIVEN    the standard test store "consonant-test-store-01"
WHEN     starting a transaction based on commit 5c127eaf
AND      defining a delete action
AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
AND      defining a commit action
AND      setting the action target to "refs/heads/master"
AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
AND      setting the action author-date to "1380539061 +0100"
AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
AND      setting the action committer-date to "1380539061 +0100"
AND      setting the action message to "Delete a card"
AND      submitting the invalid transaction
AND      fetching objects from the latest commit
THEN     this fails

Apply an invalid transaction that deletes a non-existent object
---------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes a non-existent object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to uuid: somenonexistentobject
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that deletes an object created in a non-existent action
------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes an object created in a non-existent action
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to action: non-existent action
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that deletes an object created in a later action
-----------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes an object created in a later action
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to action: later action
    AND      defining a create action
    AND      setting the action id to "later action"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "New card"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a raw property of a non-existent object
---------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a raw property of a non-existent object
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update-raw-property action
    AND      setting the action target object to uuid: i-do-not-exist
    AND      setting the action property to "something"
    AND      defining raw property data with the content type "text/plain"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a raw property of a non-existent object"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a raw property of a non-existent action
---------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a raw property of a non-existent action
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update-raw-property action
    AND      setting the action target object to action: i-do-not-exist
    AND      setting the action property to "something"
    AND      defining raw property data with the content type "text/plain"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a raw property of a non-existent action"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a raw property of an object only created later
----------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a raw property of an object only created later
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining raw property data with the content type "text/plain"
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and modify an attachment in an invalid way"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction with a raw property update that lacks a property name
----------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction with a raw property update that lacks a property name
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      defining raw property data with the content type "text/plain"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a raw property without providing its name"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a non-raw property like a raw property
--------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-raw property like a raw property
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update-raw-property action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the action property to "title"
    AND      defining raw property data with the content type "text/plain"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card as if it was a raw property"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction that updates a raw property to an invalid content type
-----------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a raw property to an invalid content-type
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining raw property data with the content type "invalid/content-type"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Set invalid content type of raw property"
    AND      submitting the invalid transaction
    THEN     this fails

Apply an invalid transaction where the raw property data is missing
-------------------------------------------------------------------

    SCENARIO apply an invalid transaction where the raw property data missing
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Raw property data is missing"
    AND      submitting the invalid transaction
    THEN     this fails

Apply a valid transaction that updates a raw property
-----------------------------------------------------

    SCENARIO apply a valid transaction that updates a raw property
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining raw property data with the content type "text/plain"
    AND      setting the raw property data to "foo"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create attachment"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the newly created object in "schema-v2" has exactly 1 property set
    AND      the property "data" of the newly created object in "schema-v2" is set to "text/plain"
    AND      the data of the raw property "data" of the newly created object in "schema-v2" is set to "foo"

Apply a valid transaction that updates a raw property twice
-----------------------------------------------------------

    SCENARIO apply a valid transaction that updates a raw property twice
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action id to "create-attachment"
    AND      setting the action class to "attachment"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining raw property data with the content type "text/plain"
    AND      setting the raw property data to "foo"
    AND      defining an update-raw-property action
    AND      setting the action target object to action: create-attachment
    AND      setting the action property to "data"
    AND      defining raw property data with the content type "text/plain"
    AND      setting the raw property data to "bar"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create attachment"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the newly created object in "schema-v2" has exactly 1 property set
    AND      the property "data" of the newly created object in "schema-v2" is set to "text/plain"
    AND      the data of the raw property "data" of the newly created object in "schema-v2" is set to "bar"
