Apply and validate transactions and check the results
=====================================================

Start a transaction
-------------------

    IMPLEMENTS WHEN starting a transaction based on commit ([0-9abcdef]{8})

    cat <<-EOF > $DATADIR/transaction.yaml
    Content-Type: multipart/mixed; boundary=CONSONANT

    --CONSONANT
    Content-Type: application/x-yaml

    action: begin
    source: $MATCH_1
    EOF

Define a commit action
----------------------

    IMPLEMENTS WHEN defining a commit action
    cat <<-EOF >> $DATADIR/transaction.yaml
    --CONSONANT
    Content-Type: application/x-yaml

    action: commit
    EOF

Setting fields of the current transaction action
------------------------------------------------

    IMPLEMENTS WHEN setting the action (.+) to "(.+)"

    cat <<-EOF >> $DATADIR/transaction.yaml
    $MATCH_1: $MATCH_2
    EOF

Submitting a transaction
------------------------

    IMPLEMENTS WHEN submitting the transaction

    cat $DATADIR/transaction.yaml

    run_consonant_store <<-EOF
    parser = consonant.transaction.parsers.TransactionParser()
    transaction = parser.parse(open('transaction.yaml'))
    validator = consonant.transaction.validation.CommitValidator()
    commit = store.prepare_transaction(transaction)
    store.commit_transaction(transaction, commit, validator)
    EOF

    fail_unknown_api
