Applying and validations transactions using consonant.store
===========================================================

Apply an invalid transaction that creates a new object of a non-existent class using consonant.store
----------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates a new object of a non-existent class using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action class to "bucket"
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Modify no objects"
    AND      submitting the invalid transaction
    THEN     an ActionClassUnknownError is thrown

Apply an invalid transaction that creates a new object with a non-existent property using consonant.store
---------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates a new object with a non-existent property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "nonexistentproperty" to "Hello"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Modify no objects"
    AND      submitting the invalid transaction
    THEN     an ActionPropertyUnknownError is thrown

Apply an invalid transaction that modifies a raw property in a create action using consonant.store
--------------------------------------------------------------------------------------------------

TODO - the example schema has no raw property definitions yet, so we
cannot test this at the moment.

Apply an invalid transaction that creates a new object that references a non-existent object using consonant.store
------------------------------------------------------------------------------------------------------------------

TODO - the example schema only has bidirectional references. To create
an object that references another, we have to not just have an
implementation of create but also of update actions.

Apply a valid transaction to a non-existent commit using consonant.store
------------------------------------------------------------------------

    SCENARIO apply a transaction to a non-existent commit using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit abcdef12
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Modify no objects"
    AND      submitting the transaction based on the non-existent commit
    THEN     a CommitNotFoundError is thrown

Apply an invalid transaction that creates an object but doesn't set all mandatory properties using consonant.store
------------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that creates an object but doesn't set all mandatory properties using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a create action
    AND      setting the action id to "create-new-card"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "This is a new card"
    AND      defining an update action
    AND      setting the action target object to action: create-new-card
    AND      setting the object properties
    AND      setting the object text property "title" to "The updated title of the new card"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and update a new card"
    AND      submitting the invalid transaction

    THEN     a MandatoryPropertyNotSetError is thrown

Apply an invalid transaction that updates a non-existent property using consonant.store
---------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object text property "nonexistent" to "Yeah, hmm"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent property"
    AND      submitting the invalid transaction
    THEN     an ActionPropertyUnknownError is thrown

Apply an invalid transaction that updates a non-existent object using consonant.store
-------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent object using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: i-do-not-exist
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent object"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesANonExistentObjectError is thrown

Apply an invalid transaction that updates a non-existent action using consonant.store
-------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates a non-existent action using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to action: non-existent
    AND      setting the object properties
    AND      setting the object text property "title" to "Bucket 1"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update a non-existent object"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesANonExistentActionError is thrown

Apply an invalid transaction that updates an object only created later using consonant.store
--------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that updates an object only created later using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to action: create-the-card
    AND      setting the object properties
    AND      setting the object text property "title" to "Overwritten title"
    AND      defining a create action
    AND      setting the action id to "create-the-card"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "Original title"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create and modify a card in an invalid way"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesALaterActionError is thrown

Apply an invalid transaction that deletes an object but does not remove references to it using consonant.store
--------------------------------------------------------------------------------------------------------------

TODO: the scenario below can only be added once there is a functional
implementation of validating commits resulting from transactions in
python-consonant.

SCENARIO apply an invalid transaction that deletes an object but does not removes references to it using consonant.store
GIVEN    the standard test store "consonant-test-store-01"
WHEN     starting a transaction based on commit 5c127eaf
AND      defining a delete action
AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
AND      defining a commit action
AND      setting the action target to "refs/heads/master"
AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
AND      setting the action author-date to "1380539061 +0100"
AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
AND      setting the action committer-date to "1380539061 +0100"
AND      setting the action message to "Delete a card"
AND      submitting the invalid transaction
AND      fetching objects from the latest commit
THEN     a ...Error is thrown

Apply an invalid transaction that deletes a non-existent object using consonant.store
-------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes a non-existent object using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to uuid: somenonexistentobject
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesANonExistentObjectError is thrown

Apply an invalid transaction that deletes an object created in a non-existent action using consonant.store
----------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes an object created in a non-existent action using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to action: non-existent action
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesANonExistentActionError is thrown

Apply an invalid transaction that deletes an object created in a later action using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that deletes an object created in a later action using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining a delete action
    AND      setting the action target object to action: later action
    AND      defining a create action
    AND      setting the action id to "later action"
    AND      setting the action class to "card"
    AND      setting the object properties
    AND      setting the object text property "title" to "New card"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Delete a non-existent object"
    AND      submitting the invalid transaction
    THEN     an ActionReferencesALaterActionError is thrown

Apply a transaction that sets a boolean property using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply a transaction that sets a boolean property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "doable" to false
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Mark a card as not doable"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to False

Apply an invalid transaction that sets a boolean property to an invalid value using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a boolean property to an invalid value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "doable" to 12345
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break a card's doable hint"
    AND      submitting the invalid transaction

    THEN     a BooleanPropertyValueInvalidError is thrown

Apply a transaction that sets an int property using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply a transaction that sets an int property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "number" to 123
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Change the number of a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 123
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to True

Apply an invalid transaction that sets an int property to an invalid value using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets an int property to an invalid value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object int property "number" to true
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break a card's number"
    AND      submitting the invalid transaction

    THEN     an IntPropertyValueInvalidError is thrown

Apply a transaction that sets an float property using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply a transaction that sets an float property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object float property "estimate" to 12.345
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Change the estimate of a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 12.345
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to True

Apply an invalid transaction that sets an float property to an invalid value using consonant.store
---------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets an float property to an invalid value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object float property "estimate" to 12345
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break a card's estimate"
    AND      submitting the invalid transaction

    THEN     an FloatPropertyValueInvalidError is thrown

Apply a transaction that sets a text property using consonant.store
-------------------------------------------------------------------

    SCENARIO apply a transaction that sets a text property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object text property "title" to "Foo"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit

    THEN     the transaction affects exactly 1 object
    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 2 properties set
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Foo"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"

Apply an invalid transaction that sets a text property to a non-string value using consonant.store
--------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a text property to a non-string value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object text property "title" to 12345
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a TextPropertyValueNotAStringError is thrown

Apply an invalid transaction that sets a text property to an invalid value using consonant.store
------------------------------------------------------------------------------------------------

Invalid in this case means a value that does not match any of the
regular expressions defined for the text property.

    SCENARIO apply an invalid transaction that sets a text property to an invalid value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object single-line text property "title" to a multi-line string
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break the title of a card"
    AND      submitting the invalid transaction

    THEN     a TextPropertyValueInvalidError is thrown

Apply a transaction that sets a timestamp property using consonant.store
------------------------------------------------------------------------

In order to do this with the test store we have create a milestone.

    SCENARIO apply a transaction that sets a timestamp property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action class to "milestone"
    AND      setting the object properties
    AND      setting the object text property "title" to "Milestone 1"
    AND      setting the object timestamp property "deadline" to "1381949764 +0100"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new milestone"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"
    AND      the newly created object in "schema-v2" has exactly 2 properties set
    AND      the property "title" of the newly created object in "schema-v2" is set to "Milestone 1"
    AND      the property "deadline" of the newly created object in "schema-v2" is set to "1381949764 +0100"

Apply an invalid transaction that sets a timestamp property to a non-string value using consonant.store
-------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a timestamp property to a non-string value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action class to "milestone"
    AND      setting the object properties
    AND      setting the object text property "title" to "Milestone 1"
    AND      setting the object timestamp property "deadline" to 54321
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new milestone"
    AND      submitting the invalid transaction

    THEN     a TimestampPropertyValueNotAStringError is thrown

Apply an invalid transaction that sets a timestamp property to an invalid value using consonant.store
-----------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a timestamp property to an invalid value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining a create action
    AND      setting the action class to "milestone"
    AND      setting the object properties
    AND      setting the object text property "title" to "Milestone 1"
    AND      setting the object timestamp property "deadline" to "0000 0000"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Create a new milestone"
    AND      submitting the invalid transaction

    THEN     a TimestampPropertyValueInvalidError is thrown

Apply an invalid transaction that sets a raw property to an invalid value using consonant.store
-----------------------------------------------------------------------------------------------

TODO

Apply an invalid transaction that sets a reference property to a non-dict value using consonant.store
-----------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a reference property to a non-dict value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to 12345
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyValueNotADictError is thrown

Apply an invalid transaction that sets a reference property without a UUID using consonant.store
------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a reference property without a UUID using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to { ref: master }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyUUIDUndefinedError is thrown

Apply an invalid transaction that puts a non-string UUID into a reference property using consonant.store
--------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that puts a non-string UUID into a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to { uuid: 12345 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyUUIDNotAStringError is thrown

Apply an invalid transaction that puts an invalid UUID into a reference property using consonant.store
------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that puts an invalid UUID into a reference property consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to uuid: 123invalid+uuid321
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyUUIDInvalidError is thrown

Apply an invalid transaction that puts a non-string ref into a reference property using consonant.store
-------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that puts a non-string ref into a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to { uuid: this-is-ok, ref: 12345 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyRefNotAStringError is thrown

Apply an invalid transaction that puts a non-string service into a reference property using consonant.store
-----------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that puts a non-string service into a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 5c127eaf
    AND      defining an update action
    AND      setting the action target object to uuid: 633715b8-70ea-4b06-94c6-43ee83a8df9e
    AND      setting the object properties
    AND      setting the object reference property "lane" to { uuid: this-is-ok, service: 12345 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/master"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Update the title of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyServiceNotAStringError is thrown

Apply an invalid transaction that sets a boolean list property to an invalid value using consonant.store
--------------------------------------------------------------------------------------------------------

TODO

Apply an invalid transaction that sets an int list property to an invalid value using consonant.store
-----------------------------------------------------------------------------------------------------

TODO

Apply an invalid transaction that sets a float list property to an invalid value using consonant.store
------------------------------------------------------------------------------------------------------

TODO

Apply a transaction that sets a text list property using consonant.store
------------------------------------------------------------------------------------------------------

    SCENARIO apply a transaction that sets a text list property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object list property "assignees"
    AND      adding a list element "foo@bar.org"
    AND      adding a list element "baz@project.org"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Change the assignees of a card"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "schema-v2"

    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 2 elements
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "foo@bar.org"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "baz@project.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to True

Apply an invalid transaction that sets a text list property to an non-list value using consonant.store
------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a text list property to a non-list value using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object text property "assignees" to "hello"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break the assignees of a card"
    AND      submitting the invalid transaction

    THEN     a ListPropertyValueNotAListError is thrown

Apply an invalid transaction that sets a text list property to a list of non-text values using consonant.store
----------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a text list property to a list of non-text values using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object list property "assignees"
    AND      adding a list element 12345
    AND      adding a list element false
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break the assignees of a card"
    AND      submitting the invalid transaction

    THEN     a TextPropertyValueNotAStringError is thrown

Apply an invalid transaction that sets a reference list property to a list of non-reference values using consonant.store
------------------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a reference list property to a list of non-reference values using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object list property "attachments"
    AND      adding a list element 12345
    AND      adding a list element false
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break the attachments of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyValueNotADictError is thrown

Apply an invalid transaction that sets a reference list property to a list of invalid references using consonant.store
----------------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that sets a reference list property to a list of invalid references using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object list property "attachments"
    AND      adding a list element { ref: master }
    AND      adding a list element { uuid: 12345 }
    AND      adding a list element uuid: 123invalid+uuid321
    AND      adding a list element { uuid: this-is-ok, ref: 12345 }
    AND      adding a list element { uuid: this-is-ok, service: 12345 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break the attachments of a card"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyUUIDUndefinedError is thrown
    AND      a ReferencePropertyUUIDNotAStringError is thrown
    AND      a ReferencePropertyUUIDInvalidError is thrown
    AND      a ReferencePropertyRefNotAStringError is thrown
    AND      a ReferencePropertyServiceNotAStringError is thrown

Apply an invalid transaction that references a non-existent action in a reference property using consonant.store
----------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that references a non-existent action in a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object reference property "lane" to { action: 1 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to a non-existent action in a reference property"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyActionNonExistentError is thrown

Apply an invalid transaction that references a later action in a reference property using consonant.store
---------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that references a later action in a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object reference property "lane" to { action: 1 }
    AND      defining an update action
    AND      setting the action id to 1
    AND      setting the action target object to uuid: 27519b8d-8ad8-4558-8ea2-f128404e6f58
    AND      setting the object properties
    AND      setting the object text property "title" to "Modified backlog"
    AND      setting the object list property "cards"
    AND      adding a list element uuid: dd7ff995-eba8-46e0-93d4-7297a691919e
    AND      adding a list element uuid: 86ab9538-3926-42ff-9fc7-e122a006cd4d
    AND      adding a list element uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to a later action in a reference property"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyReferencesALaterActionError is thrown

Apply an transaction that references an action in a reference property using consonant.store
--------------------------------------------------------------------------------------------

    SCENARIO apply an transaction that references an action in a reference property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action id to 1
    AND      setting the action target object to uuid: 27519b8d-8ad8-4558-8ea2-f128404e6f58
    AND      setting the object properties
    AND      setting the object text property "title" to "Modified backlog"
    AND      setting the object list property "cards"
    AND      adding a list element uuid: dd7ff995-eba8-46e0-93d4-7297a691919e
    AND      adding a list element uuid: 86ab9538-3926-42ff-9fc7-e122a006cd4d
    AND      adding a list element uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "doable" to false
    AND      setting the object reference property "lane" to { action: 1 }
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to an action in a reference property"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 2 objects in "schema-v2"

    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to False

    AND      the object "27519b8d-8ad8-4558-8ea2-f128404e6f58" has exactly 2 properties set
    AND      the property "title" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" is set to "Modified backlog"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" contains exactly 3 elements
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "dd7ff995-eba8-46e0-93d4-7297a691919e"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "86ab9538-3926-42ff-9fc7-e122a006cd4d"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "04be5c1b-0192-4e31-b4f8-39a084659738"

Apply an invalid transaction that references a non-existent action in a reference list property using consonant.store
---------------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that references a non-existent action in a reference list property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object list property "attachments"
    AND      adding a list element { action: 2 }
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to a non-existent action in a reference list property"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyActionNonExistentError is thrown

Apply an invalid transaction that references a later action in a reference list property using consonant.store
--------------------------------------------------------------------------------------------------------------

    SCENARIO apply an invalid transaction that references a later action in a reference list property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 27519b8d-8ad8-4558-8ea2-f128404e6f58
    AND      setting the object properties
    AND      setting the object text property "title" to "Modified backlog"
    AND      setting the object list property "cards"
    AND      adding a list element uuid: dd7ff995-eba8-46e0-93d4-7297a691919e
    AND      adding a list element uuid: 86ab9538-3926-42ff-9fc7-e122a006cd4d
    AND      adding a list element action: 1
    AND      defining an update action
    AND      setting the action id to 1
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "doable" to false
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to a later action in a reference list property"
    AND      submitting the invalid transaction

    THEN     a ReferencePropertyReferencesALaterActionError is thrown

Apply an transaction that references an action in a reference list property using consonant.store
-------------------------------------------------------------------------------------------------

    SCENARIO apply an transaction that references an action in a reference list property using consonant.store
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action id to 1
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object boolean property "doable" to false
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      defining an update action
    AND      setting the action target object to uuid: 27519b8d-8ad8-4558-8ea2-f128404e6f58
    AND      setting the object properties
    AND      setting the object text property "title" to "Modified backlog"
    AND      setting the object list property "cards"
    AND      adding a list element uuid: dd7ff995-eba8-46e0-93d4-7297a691919e
    AND      adding a list element uuid: 86ab9538-3926-42ff-9fc7-e122a006cd4d
    AND      adding a list element action: 1
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Refer to an action in a reference list property"
    AND      submitting the transaction
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 2 objects in "schema-v2"

    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Implement feature A"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to False

    AND      the object "27519b8d-8ad8-4558-8ea2-f128404e6f58" has exactly 2 properties set
    AND      the property "title" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" is set to "Modified backlog"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" contains exactly 3 elements
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "dd7ff995-eba8-46e0-93d4-7297a691919e"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "86ab9538-3926-42ff-9fc7-e122a006cd4d"
    AND      the property "cards" of "27519b8d-8ad8-4558-8ea2-f128404e6f58" includes the object "04be5c1b-0192-4e31-b4f8-39a084659738"

Apply a transaction that is rejected by a custom validation hook
----------------------------------------------------------------

    SCENARIO apply a transaction that is rejected by a commit validation
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object text property "title" to "91 Titles may not begin with numbers"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Break a card title"
    AND      submitting the invalid transaction with a validation hook that rejects card titles that begin with numbers

    THEN     a ValidationError is thrown

Apply a transaction that is accepted by a custom validation hook
----------------------------------------------------------------

    SCENARIO apply a transaction that is accepted by a commit validation
    GIVEN    the standard test store "consonant-test-store-01"
    WHEN     starting a transaction based on commit 9f3e6023
    AND      defining an update action
    AND      setting the action target object to uuid: 04be5c1b-0192-4e31-b4f8-39a084659738
    AND      setting the object properties
    AND      setting the object text property "title" to "Titles may not begin with numbers"
    AND      defining a commit action
    AND      setting the action target to "refs/heads/schema-v2"
    AND      setting the action author to "Samuel Bartlett <samuel@yourproject.org>"
    AND      setting the action author-date to "1380539061 +0100"
    AND      setting the action committer to "IRC Code Review Bot <reviewbot@yourproject.org>"
    AND      setting the action committer-date to "1380539061 +0100"
    AND      setting the action message to "Change the title of a card"
    AND      submitting the transaction with a validation hook that rejects card titles that begin with numbers
    AND      fetching objects from the latest commit in "schema-v2"

    THEN     the transaction affects exactly 1 object in "refs/heads/schema-v2"
    AND      the object "04be5c1b-0192-4e31-b4f8-39a084659738" has exactly 6 properties set
    AND      the property "number" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 1
    AND      the property "title" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to "Titles may not begin with numbers"
    AND      the property "lane" of "04be5c1b-0192-4e31-b4f8-39a084659738" references "27519b8d-8ad8-4558-8ea2-f128404e6f58"
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" contains exactly 1 element
    AND      the property "assignees" of "04be5c1b-0192-4e31-b4f8-39a084659738" includes the value "jeff@yourproject.org"
    AND      the property "estimate" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to 0.5
    AND      the property "doable" of "04be5c1b-0192-4e31-b4f8-39a084659738" is set to True
